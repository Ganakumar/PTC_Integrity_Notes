<!-- -->
<%version 1%>
<%description
    <b>Data: </b>Mitigation Report<br>
    <b>Notes: </b>This report displays Mitigation document details.<br>
%>
<%param 
    name="reporttitle" 
    type="String" 
    prompt="Report Title" 
    value="Mitigation Report" 
    description="Descriptive title for your report."
%>
<%param
    name="reportfooter" 
    type="MultiString" 
    prompt="Report Footer" 
    value="" 
    description="Text appearing at the bottom of the report page."
%>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>&reporttitle</title>

    <link rel="shortcut icon" class="rounded-circle" href="<%hosturl%>Custom/Images/TerumoBCT.png" />
	<link rel="stylesheet" href="<%hosturl%>Custom/Bootstrap/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="<%hosturl%>Custom/Bootstrap/1.10.22-jquery.dataTables.min.css"/>
	<link rel="stylesheet" type="text/css" href="<%hosturl%>Custom/Bootstrap/1.6.5-buttons.dataTables.min.css"/> 
	<link rel="stylesheet" type="text/css" href="<%hosturl%>Custom/Bootstrap/4.5.2-bootstrap.css"/>  

	<script src="<%hosturl%>Custom/Bootstrap/jquery.min.js"></script>
    <script src="<%hosturl%>Custom/Bootstrap/bootstrap.min.js"></script>
	<script type="text/javascript" src="<%hosturl%>Custom/Bootstrap/1.10.22-jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="<%hosturl%>Custom/Bootstrap/1.2.2-buttons.print.min.js"></script>
    <script type="text/javascript" src="<%hosturl%>Custom/Bootstrap/1.6.5-dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="<%hosturl%>Custom/Bootstrap/3.1.3-jszip.min.js"></script> 
    <script type="text/javascript" src="<%hosturl%>Custom/Bootstrap/0.1.53-vfs_fonts.js"></script>
    <script type="text/javascript" src="<%hosturl%>Custom/Bootstrap/1.6.5-buttons.html5.min.js"></script>

    <script>
        var headingAdded = false;
        var contentRow = '<tr>';
        var detailedContentRow = '';
        var defaultTd = ``;
        var noOfContentHeadings = 0;
        var noOfMitigationsHeading = 0;
    </script>

    <style>
	<!-- CSS -->
	table.pretty thead th {

		text-align: center;

		background: #000000;

	}
    #tdID td, tr{
        border: 2px solid #000000;
    }

    .trdisable:hover {
		background-color: #ffffff !important
    }
	.footer {
		left: 0;
		background-color: #ffffff;
		bottom: 5px;
		width: 100%;
		top: 50%;
		height: 60px;
		position: relative;
	}
	table {
		width: 100%;
	}
	label {
		display: inline-flex;
		margin-bottom: .5rem;
		margin-top: .5rem;
	}
	
    </style>
</head>

<%dateformat MM/dd/yyyy h:mm:ss a%>
<%datetimeformat MM/dd/yyyy h:mm:ss a%>
<%sortby &sortby%>
<%begindetail%>

<body>
<!-- Navigation Bar -->
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
        <div class="col-md-12">
            <ul class="navbar-nav">
                <div class="col-md-5"> 
                    <a class="navbar-brand" href="https://www.terumobct.com/">
                        <img style="height: 35px; margin-left: -30px; width: 225px;"  class="terumologo" src="<%hosturl%>Custom/Images/TerumoBCT.png" target="_blank" title="TERUMOBCT" align="middle">
                    </a>
                </div>
                <div class="col-md-6">
                    <h2 class="float-left text-white">&reporttitle</h2>
                </div>
                <!-- Dropdown -->
                <div class="col-md-1 ml-4">
                    <li class="nav-item dropleft">
                        <a class="nav-link dropdown-toggle text-white" href="#" id="navbardrop" data-toggle="dropdown">Action</a>
                        <div class="dropdown-menu">
                            <a id ="ExportReporttoExcel"  class="dropdown-item datatable-excel"  href="#">
                                <img src="<%hosturl%>Custom/Images/microsoft-excel.png" class="img-fluid rounded text-white"  alt="Eport to Excel" style="height: 30px;"/>
                                <label style="margin-left:1rem;">Excel</label>
                            </a>
                            <a id="ExportReporttoPDF" class="dropdown-item"  href="#">
                                <img src="<%hosturl%>Custom/Images/PDF_file_icon.svg.png" class="img-fluid rounded text-white"  alt="Export to PDF" style="height: 25px; width: 24px;margin-left: 2px;"/>
                                <label style="margin-left:1.2rem;">PDF</label>
                            </a>                           
							<a class="dropdown-item" href="<%hosturl%>im/runreport?selection=&currentReportName&issues=<%ID%>">
                                <img src="<%hosturl%>Custom/Images/rerun.png" class="img-fluid rounded text-white"  alt="Re-Run Prport" style="height: 30px;"/>
                                <label style="margin-left:1rem;">Re-Run</label>
                            </a>
                        </div>
                    </li>
                </div>
            </ul>
        </div>
    </nav>
    <hr>
	<!-- Mitigation Document Table -->
    <div class="ml-5 col-md-12 col-lg-11">
	    <div style="width:102%">
		    <table  class="table table-border border-dark" id ="tdID">
                <thead class="text-center">
			        <tr>integrity://<server>:<port>/<app>/<command>?selection=<id>
				        <th style="border: 1px solid black;" colspan="6">Mitigation Effectiveness Report for : <a id="documentLink" href="integrity://<%hostname%>:<%hostport%>/im/viewissue?selection=<%ID%>" target="_blank"><%ID%></a></th>
			        </tr>
			    </thead>
				<tbody id="tableDetail">	
					<tr class="tableID">
						<th colspan="1">Project</th>
						<td colspan="5"><%Project%></td>
					</tr>
					<tr>
						<th>Document name</th>
						<td ><%Short Title%></td>
						<th>Document State </th>
                        <td><%State%></td>
                        <th >Doc Owner</th>
						<td><%Created By%></td>
					</tr>
					<tr>
						<th >Reviewed By</th>
						<td ><%Modified By%></td>
						<th >Approved By</th>
						<td	colspan="3"> Administrator</td>
					</tr>
					<tr>
						<th >Published on</th>
						<td ><%currentdate%></td>
						<th>Rev No</th>
						<td colspan="3">1.1</td>
					</tr>
				</tbody>
			</table>
		</div>
	    <div  style="width: 102%;">
			<table id="detailTable"  class="table table-striped table-bordered" style="width:100%">
			<!-- Mitigation Document Content Table -->
				<%segment
					name="Level 1 Relationships"
					type="relationship"
					enabled="true"
					description="<html>Displays related items that are two levels below the item returned by the report query.</html>"
				%>
					<thead>
						<tr>		
							<th style="text-align: center;"id ="headingContent" scope="col">Mitigations</th>
							<th style="text-align: center;" id ="headingMitigations" scope="col">Requirement traced to Mitigations</th>				
						</tr>
						<tr id = "subHeading" class="thead-dark">
							<%iteraterelationshipfields%><!-- Start Table Relationshipdetai Table Header -->	
								<th id ="tdRelationshipL1">
									&relationshipfielddisplayname	
									<script>noOfContentHeadings++;</script>
								</th>
							<%/iteraterelationshipfields%>
						</tr>
					</thead>
					<tbody id="myTable">
					<script>
						<%beginrelationshipsdetail Query[ ( (walk[<%builtin Contains%>] <%ID%>))]%><!-- Go to Table Relationshipdetail Contains -->
							if("<%Relationship Category%>" !="Heading" && "<%Relationship Category%>" !="Comment"){ // Filter protocol based on state
						
							<%iteraterelationshipfields%><!-- Start Content table body -->
									
									if("&relationshipfielddisplayname" === "ID"){
										contentRow += '<td><a  href="integrity://<%hostname%>:<%hostport%>/im/viewissue?selection=&relationshipfieldname" target="_blank">&relationshipfieldname</a></td>' ;
									} else {
										contentRow += "<td>&relationshipfieldname</td>" ;
									}
								
							<%/iteraterelationshipfields%><!-- End Table Relationshipdetail table body -->					
						<!-- Product/LLR Requirement Documet Table -->	
						
							<%segment
								name="Level 2 Relationships"
								type="relationship"
								enabled="true"
								description="<html>Displays related items that are three levels below the item returned by the report query.</html>"
							%>
								<%iteraterelationshipfields%><!-- Start Mitigated BY table Heading -->
									
										if(!headingAdded){
											$("#subHeading").append(",<th>&relationshipfielddisplayname</th>");
											defaultTd += `<td></td>`;
											noOfMitigationsHeading++;
										}											
									
								<%/iteraterelationshipfields%>	<!-- End Mitigated BY table Heading -->
									headingAdded = true;
									$("#headingContent").attr("colspan",noOfContentHeadings);
									$("#headingMitigations").attr("colspan",noOfMitigationsHeading);
								<%beginrelationshipsdetailL2 Mitigated By%><!-- Go to Table RelationshipdetailL2 Mitigeted BY -->
									<%iteraterelationshipfields%><!-- Start Mitigated BY table body -->
											if("&relationshipfielddisplayname" === "ID"){
												detailedContentRow +='<td> <a  href="integrity://<%hostname%>:<%hostport%>/im/viewissue?selection=&relationshipfieldname" target="_blank">&relationshipfieldname</a></td>';
											} else {
												detailedContentRow +="<td>&relationshipfieldname</td>";
											}
									<%/iteraterelationshipfields%><!-- End Mitigated BY table body -->
											document.write(contentRow+detailedContentRow+'</tr>');
											detailedContentRow = '';
									<%beginrelationshipsection none%><!-- Start default value for table body -->
											document.write(contentRow+defaultTd+'</tr>');
									<%endrelationshipsection%><!-- End default value for table body -->
								<%endrelationshipsdetailL2%><!-- End RelationshipdetailL2 -->
									contentRow = '<tr>';
							<%/segment%>
							}							
						<%endrelationshipsdetail%><!-- End RelationshipdetailL2 -->
						</script>
					</tbody>					
				<%/segment%>
			</table>
		</div>
    </div>
	<!-- Footer -->
    <div class="footer" id="pageFooter">
	    <hr>
	    <div class="text-center py-3">&reportfooter</div>
		<div class="text-center py-3"><%currentdate%></div>
    </div>
    <script>
        $(document).ready(function(){
			<!-- Data Table -->
            $("#detailTable").DataTable({
			 "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
			 "autoWidth": false,
			 "paging":   true,
			 "ordering": true,
			 "info":     true,

                dom: 'lBfrtip',
				<!-- Action Button -->
                buttons: [{
						extend: 'excelHtml5',
						title: 'Mitigation Report <%ID%>'
					}, 'print' 
				],
				
            });
			$("#ExportReporttoExcel").on("click", function() {
				$(".buttons-excel").trigger("click");
			});
			$("#ExportReporttoPDF").on("click", function() {
				$(".buttons-print").trigger("click");
			});
			$(".dt-buttons").css("display","none");
		});
    </script>
</body>
<%enddetail%>
</html>